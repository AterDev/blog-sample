@* Add component TypeScript (with imports and stable formatting) *@
@{
    var name = ModelName ?? "Model";
    var camel = (ModelName ?? "Model").ToCamelCase();
    var module = (Namespace ?? string.Empty).Split('.').LastOrDefault()?.ToHyphen() ?? string.Empty;
  var hasEnumAdd = AddPropertyInfos.Any(p => p.IsEnum);
  var enumImports = hasEnumAdd ? ", ToKeyValuePipe, EnumTextPipe" : string.Empty;
}
import { Component } from '@@angular/core';
import { AbstractControl, FormBuilder, FormGroup, Validators } from '@@angular/forms';
import { MatDialogRef } from '@@angular/material/dialog';
import { MatCheckboxModule } from '@@angular/material/checkbox';
import { TranslateService } from '@@ngx-translate/core';
import { AdminClient } from 'src/app/services/admin/admin-client';
import { I18N_KEYS } from 'src/app/share/i18n-keys';
import { CommonFormModules } from 'src/app/share/shared-modules';
@{ if (hasEnumAdd) { WriteLiteral("import { ToKeyValuePipe } from 'src/app/share/pipe/to-key-value.pipe';\n"); WriteLiteral("import { EnumTextPipe } from 'src/app/pipe/admin/enum-text.pipe';\n"); } }
import { @(ModelName)AddDto } from 'src/app/services/admin/models/@(module)/@(ModelName.ToHyphen())-add-dto.model';

@{ WriteLiteral("@Component({\n  selector: 'app-" + camel + "-add',\n  imports: [CommonFormModules, MatCheckboxModule" + enumImports + "],\n  templateUrl: './add.html'\n})\n"); }
export class @(ModelName)Add {

  i18nKeys = I18N_KEYS;

  form!: FormGroup;

  constructor(
    private fb: FormBuilder,
    private adminClient: AdminClient,
    private dialogRef: MatDialogRef<@(ModelName)Add>,
    private translate: TranslateService
  ) {
    this.buildForm();
  }

  buildForm() {
    this.form = this.fb.group({
      @( string.Join(",\n      ", AddPropertyInfos.Select(p => "\"" + p.Name.ToCamelCase() + "\": [null, [" + (p.IsRequired ? "Validators.required" : "") + (p.MinLength.HasValue ? ((p.IsRequired ? ", " : "") + "Validators.minLength(" + p.MinLength + ")") : "") + (p.MaxLength.HasValue ? ((p.IsRequired || p.MinLength.HasValue) ? ", " : "") + "Validators.maxLength(" + p.MaxLength + ")" : "") + "]]")) )
    });
  }

  getValidatorMessage(control: AbstractControl | null): string {
    if (!control || !control.errors) { return ''; }
    const errors = control.errors;
    const key = Object.keys(errors)[0];
    const params = errors[key];
    return this.translate.instant(`validation.${key.toLowerCase()}`, params);
  }

  submit() {
    if (this.form.invalid) return;
    this.adminClient.@(camel).add(this.form.value as @(ModelName)AddDto).subscribe(() => this.dialogRef.close(true));
  }

  close(result: boolean) { this.dialogRef.close(result); }
}