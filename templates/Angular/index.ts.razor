@{
    var modelNameCamel = ModelName.ToCamelCase();
    var modelNameHyphen = ModelName.ToHyphen();
}
import { Component, OnInit, ViewChild, signal } from '@@angular/core';
import { MatPaginator, PageEvent, MatPaginatorModule } from '@@angular/material/paginator';
import { MatTableDataSource, MatTableModule } from '@@angular/material/table';
import { MatDialog, MatDialogModule } from '@@angular/material/dialog';
import { MatToolbarModule } from '@@angular/material/toolbar';
import { MatButtonModule } from '@@angular/material/button';
import { MatIconModule } from '@@angular/material/icon';
import { MatInputModule } from '@@angular/material/input';
import { MatFormFieldModule } from '@@angular/material/form-field';
import { MatSelectModule } from '@@angular/material/select';
import { MatSlideToggleModule } from '@@angular/material/slide-toggle';
import { FormsModule } from '@@angular/forms';
import { RouterLink, ActivatedRoute } from '@@angular/router';
import { TranslocoModule } from '@@jsverse/transloco';

import { AdminClient } from 'src/app/services/admin-client.service';
import { @(ModelName)FilterDto, @(ModelName)ItemDto } from 'src/app/services/admin-client.service';
import { ConfirmDialogComponent } from 'src/app/share/components/confirm-dialog/confirm-dialog.component';
import { AddComponent } from './add/add.component';
import { EditComponent } from './edit/edit.component';
import { form, Field } from '@@angular/forms/signals';

@@Component({
  selector: 'app-@(modelNameHyphen)-index',
  templateUrl: './index.html',
  standalone: true,
  imports: [
    MatTableModule, MatPaginatorModule, MatToolbarModule, MatButtonModule, 
    MatIconModule, MatInputModule, MatFormFieldModule, MatSelectModule, MatSlideToggleModule,
    FormsModule, RouterLink, TranslocoModule, MatDialogModule, Field
  ]
})
export class IndexComponent implements OnInit {
  @@ViewChild(MatPaginator) paginator!: MatPaginator;
  
  filterModel = signal<@(ModelName)FilterDto>({
    pageIndex: 1,
    pageSize: 10
  });

  filterForm = form(this.filterModel);

  dataSource = new MatTableDataSource<@(ModelName)ItemDto>([]);
  totalCount = signal(0);
  columns = [@foreach(var prop in ItemPropertyInfos){<text>'@prop.Name.ToCamelCase()', </text>}'actions'];

  constructor(
    private adminClient: AdminClient, 
    private dialog: MatDialog,
    private route: ActivatedRoute
  ) {}

  ngOnInit(): void {
    this.getList();
  }

  getList() {
    this.adminClient.@(modelNameCamel).filter(this.filterModel()).subscribe(res => {
      if (res.data) {
        this.dataSource.data = res.data;
        this.totalCount.set(res.totalCount);
      }
    });
  }

  onPageChange(event: PageEvent) {
    this.filterModel.update(f => ({ ...f, pageIndex: event.pageIndex + 1, pageSize: event.pageSize }));
    this.getList();
  }

  openAdd() {
    const ref = this.dialog.open(AddComponent, { width: '800px' });
    ref.afterClosed().subscribe(res => {
      if (res) this.getList();
    });
  }

  openEdit(item: @(ModelName)ItemDto) {
    const ref = this.dialog.open(EditComponent, { width: '800px', data: item });
    ref.afterClosed().subscribe(res => {
      if (res) this.getList();
    });
  }

  delete(item: @(ModelName)ItemDto) {
    const ref = this.dialog.open(ConfirmDialogComponent, {
      data: { title: 'confirmDelete', content: 'confirmDelete' }
    });
    ref.afterClosed().subscribe(res => {
      if (res) {
        this.adminClient.@(modelNameCamel).delete(item.id).subscribe(() => {
          this.getList();
        });
      }
    });
  }
}
